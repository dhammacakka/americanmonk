{{/*
  Use Hugo's native Table of contents feature. You must set `toc: true` in your parameters for this to show.
  https://gohugo.io/content-management/toc/
*/}}
{{ if .Params.categories }}
  <div class="related-sidebar">
    <h3>Categories</h3>
    <ul class="related-list">

      {{ range .Params.categories }}
        {{ $name := . }}
        {{ $slug := urlize $name }}

        {{/* Get taxonomy term (for count) */}}
        {{ $term := index site.Taxonomies.categories $slug }}

        {{/* Get category page (for icon) */}}
        {{ $catPage := site.GetPage (printf "categories/%s" $slug) }}
        {{ $icon := $catPage.Params.icon | default "fa-tag" }}

        {{/* Pull color from data/colors.yaml (fallback purple) */}}
        {{ $color := index site.Data.colors $slug | default "purple" }}

        <li class="related-card">
          <a href="{{ `/categories/` | relLangURL }}{{ $slug }}" class="related-card-link">
            <div class="related-card-inner">

              <i class="fa-solid {{ $icon }} fa-2x related-thumb"
                 style="color: {{ $color }};"></i>

              <div class="related-card-content">
                <h4 class="related-title">{{ $name }}</h4>
                <p class="f7 mid-gray mt1">
                  {{ len $term.Pages }} posts
                </p>
              </div>

            </div>
          </a>
        </li>
      {{ end }}

    </ul>
  </div>
{{ end }}

{{/*
  Use Hugo's native related content feature to pull in content that may have similar parameters, like tags, etc.
  https://gohugo.io/content-management/related/
*/}}

{{ $related := .Site.RegularPages.Related . | first 15 }}
{{ with $related }}
  <div class="related-sidebar">
    <h3>Related Posts</h3>
    <ul class="related-list">
      {{ range . }}
        {{ $thumb := partial "func/GetFeaturedImage.html" . }}
        {{ if $thumb }}
          {{ $img := resources.Get $thumb }}
          {{ if $img }}
            {{ $small := $img.Fit "150x150" }}
            <li class="related-card">
              <a href="{{ .RelPermalink }}" class="related-card-link">
                <img src="{{ $small.RelPermalink }}" alt="{{ .Title }}" class="related-thumb">
                <div class="related-card-content">
                  <h4 class="related-title">{{ .Title }}</h4>
                </div>
              </a>
            </li>
          {{ else }}
            <li class="related-card">
              <a href="{{ .RelPermalink }}" class="related-card-link">
                <div class="related-card-content">
                  <h4 class="related-title">{{ .Title }}</h4>
                </div>
              </a>
            </li>
          {{ end }}
        {{ end }}
      {{ end }}
    </ul>
  </div>
{{ end }}

{{ partial "sidebar-subscribe.html" . }}
